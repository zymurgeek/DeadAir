<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<HTML xmlns="http://www.w3.org/1999/xhtml">
  <HEAD>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Dead Air</title>
  </HEAD>
  <BODY>
    <!-- https://developers.google.com/youtube/iframe_api_reference -->
    <!-- 1. The <iframe> (and video player) will replace this <div> tag. -->
    <div id="player"></div>
    <div id="playlistinfo"></div>
    <script>
      var playlistId = 'PLIhsL76FAVWRB6jgvbCpiT8cCnyHSwmn1';
      var editable = '&jct=68mng4z2XIFtkdMNqIdcVItSvhxeaw';
      var INITIAL_LOAD = 'INITIAL_LOAD';
      var PLAYING = 'PLAYING';
      var RELOADING_PLAYLIST = 'RELOADING_PLAYLIST';
      var lastPlaylist = []

      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var playlistUrl = 'https://www.youtube.com/playlist?list='
        + playlistId + editable;
      var playlistInfo = '<p>Add videos to the play list at '
        + '<a href="' + playlistUrl + '">' + playlistUrl + '</a>'
        + '<p>First, add the play list to your account '
        + 'by browsing to the link above '
        + 'and selecting "+ Save" on the play list.'
        + '<p>Then, to add a video, go to its page, and click the button '
        + 'with three lines and a "+" (next to "share").  '
        + 'Check the box next to "YouTube Party"'
        + '<p>If you don\'t queue a video before the play list ends, '
        + 'you\'ll have to reload this page.';
      var playlistInfoDiv = document.getElementById('playlistinfo');
      playlistInfoDiv.insertAdjacentHTML( 'beforeend', playlistInfo);
      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        console.log('Player ready');
        setState(INITIAL_LOAD);
        loadPlaylist();
      }

      // 5. The API calls this function when the player's state changes.
      //    The function indicates that when playing a video (state=1),
      //    the player should play for six seconds and then stop.
      function onPlayerStateChange(event) {
        console.log('onPlayerStateChange event:', getPlayerStateName());
        switch (event.data) {
          case YT.PlayerState.CUED:
            switch (state) {
              case INITIAL_LOAD:
                play();
                break;
              case RELOADING_PLAYLIST:
                if (player.getPlaylist() == lastPlaylist) {
                  pollForPlaylistUpdate();
                } else {
                  play();
                }
                break;
            }
            break;

          case YT.PlayerState.PLAYING:
            showQueue();
            break;

          case YT.PlayerState.ENDED:
            pollForPlaylistUpdate();
            break;
        }
      }

      function setState(newState) {
        state = newState;
        console.log('state:', state);
      }

      function getPlayerStateName() {
        if (player.getPlayerState() == -1) {
          return 'UNSTARTED';
        }
        if (player.getPlayerState() == 0) {
          return 'ENDED';
        }
        if (player.getPlayerState() == 1) {
          return 'PLAYING';
        }
        if (player.getPlayerState() == 2) {
          return 'PAUSED';
        }
        if (player.getPlayerState() == 3) {
          return 'BUFFERING';
        }
        if (player.getPlayerState() == 5) {
          return 'CUED';
        }
      }

      function showQueue() {
        console.log('Playing index', player.getPlaylistIndex(),
          'from current queue: ', player.getPlaylist());
      }

      function play() {
        setState(PLAYING);
        player.playVideo();
      }

      function pollForPlaylistUpdate() {
        setState(RELOADING_PLAYLIST);
        lastPlaylist = player.getPlaylist();
        loadPlaylist();
      }

      function loadPlaylist() {
        var index = 0;
        if (lastPlaylist) {
          index = lastPlaylist.length;
        }
        player.cuePlaylist({
          listType: 'playlist',
          list: playlistId,
          index: index});
      }
    </script>
  </BODY>
</HTML>
